<!DOCTYPE html>
<html>
<!-- <script type="text/javascript" name="script.js"></script> -->
<head>
  <meta charset="UTF-8">
  <title>CS50 | Swipe</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <button id="awardBtn" onClick="renderForm(0)">Awards</button>
  <button id="allocationBtn" onClick="renderForm(1)">Allocation</button>
  <button id="studentBtn" onClick="renderForm(2)">Students</button>
  <button id="collaborationBtn" onClick="renderForm(3)">Collaborators</button>
  
  <!--<script src="fetch.js"></script>-->
  <!--<script src="client.js"></script>-->
  <script>

 	//	initialize hidden forms and submit/add event handlers
  	window.onload=function() {
	  	document.getElementById("awardForm").style.display="none";
		document.getElementById("allocationForm").style.display="none";
		document.getElementById("studentForm").style.display="none";
		document.getElementById("collaborationForm").style.display="none";
		var studentFormSearch = document.getElementById("studentSubmit");
		studentFormSearch.addEventListener("click", studentFormReq, false);
		studentFormSearch.dbReq = 0;
		var studentFormAdd = document.getElementById("studentAdd");
		studentFormAdd.addEventListener("click", studentFormReq, false);
		studentFormAdd.dbReq = 1;

		//add warnings such that students can only be added with minimal required data (date etc)
		//I think you should put the event listeners into a separate function that gets called
		//when the window loads, that way it can also return and display errors perhaps

		var awardFormSearch = document.getElementById("awardSubmit");
		awardFormSearch.addEventListener("click", awardFormReq, false);
		awardFormSearch.dbReq = 0;
		var awardFormAdd = document.getElementById("awardAdd");
		awardFormAdd.addEventListener("click", awardFormReq, false);
		awardFormAdd.dbReq = 1;
		// document.getElementByName("jes").value = "no";

	}
	// document.getElementById("awardBtn").addEventListener("click", renderForm(0));
	// document.getElementById("allocationBtn").addEventListener("click", renderForm(1));
	// document.getElementById("studentBtn").addEventListener("click", renderForm(2));
	// document.getElementById("collaborationBtn").addEventListener("click", renderForm(3));

	//write functions for each query, one for insert, one for submit? or just make different request based on 
	//the button search or insert (add button to front end then maybe modify header for the fetch request ot the server)
	function studentFormReq (evt) {
		evt.preventDefault();
		var formInputs = document.getElementById("studentForm").elements;
		var obj = {};
		obj["db_req"] = evt.target.dbReq? "add" : "search";
		console.log(formInputs);
		var invalid = false;
		for(var i = 0 ; i < formInputs.length ; i++){
	        var item = formInputs.item(i);
	        obj[item.name] = item.value;
	        console.log(item.value);
	        if(obj[item.name].length == 0) { 
	        	invalid = true;
	        	console.log("HERE");
	        }
	    }
	    if (invalid && evt.target.dbReq == 1) {
	    	console.log("Please complete all fields");
	    	throw("Please complete all fields");
	    }
	    console.log(obj);
	    var jsonObj = JSON.stringify(obj);
	    console.log(jsonObj);
	    //probably havea try-Catch here with promise or something
	    fetch('/add_student', {
		    method: 'POST',
		    body: jsonObj })
		  .then(res => res.JSON()) 
		  .catch(() => alert("Failed to add student"));
		// update, search, and add will all return a response that can be jsonified
		//	and displayed in a grid
	};

	function awardFormReq (evt) {
		evt.preventDefault();
		var formInputs = document.getElementById("awardForm").elements;
		var obj = {};
		console.log(formInputs);
		var invalid = false;
		for(var i = 0 ; i < formInputs.length ;i++) {
	        var item = formInputs.item(i);
	        if (item.value.length <= 1) {
	        	invalid = true;
	        	console.log("HERE");
	        }
	        else {
	          obj[item.name] = item.value;
	          console.log(item.value);
	        }
	    }
	    if (invalid && evt.target.dbReq == 1) {
	    	throw("Please complete all fields");
	    }
	    console.log(obj);
	    var jsonObj = JSON.stringify(obj);
	    //try catch here maybe?
	    console.log(jsonObj);
	    fetch('/get_award', {
		    method: 'POST',
		    headers: {
		      'Content-Type': 'application/json',
		    },
		    body: jsonObj })
		    .then(res => JSON.parse(res.text()))
		  .then(res => fn(res)) // Results display function
		  .catch(() => alert("Failed to add student"));
		  
		// var data = [];
		// data[0] = formInputs["first_name"];
		// console.log(data);
	};

	function renderForm(a) {
		switch (a) {
			case 0:
				document.getElementById("awardForm").style.display="block";
				document.getElementById("allocationForm").style.display="none";
				document.getElementById("studentForm").style.display="none";
			    document.getElementById("collaborationForm").style.display="none";
			    break;
			case 1:
				document.getElementById("awardForm").style.display="none";
				document.getElementById("allocationForm").style.display="block";
				document.getElementById("studentForm").style.display="none";
			    document.getElementById("collaborationForm").style.display="none";
			    break;
			case 2:
				document.getElementById("awardForm").style.display="none";
				document.getElementById("allocationForm").style.display="none";
				document.getElementById("studentForm").style.display="block";
			    document.getElementById("collaborationForm").style.display="none";
			    break;
			case 3:
				document.getElementById("awardForm").style.display="none";
				document.getElementById("allocationForm").style.display="none";
				document.getElementById("studentForm").style.display="none";
			    document.getElementById("collaborationForm").style.display="block";
			    break;

		}
	}
  </script>
  <br><br>
  	<form id="awardForm" name="awardForm" method="post" enctype="multipart/form-data">
	  	<input name="Body" type="text" placeholder="Funding Body"> 
	  	<input name="Name" type="text" placeholder="Award Name">
	    <input name="funding_body_ref" type="text" placeholder="Funding Body Reference"> 
	    Award Type: <input class="checkbox-inline" type="radio" name='type' value="1">List here
	    Jes: <input class = "checkbox-inline" type="radio" name='jes' value="0">No
		<input class = "checkbox-inline" type="radio" name='jes' value="1">Yes
		<input name="award_amount" type="number" step="0.01" placeholder="Award amount">
		<input name="fes_due" type="text" placeholder="FES Due"> 
		<input name="start_date" type="date" placeholder="Start Date">
	    <input name="end_date" type="date" placeholder="End Date">
		<input id="awardSubmit" type="submit" value="" name="submit">
		<input id="awardAdd" type="submit" value="" name="add">
	</form>

	<form id="allocationForm" name="allocationForm" method="post" enctype="multipart/form-data">
	    <input name="funding_body_ref" type="text" placeholder="Funder Reference"> 
	    <input name="finance_award_no" type="number" placeholder="Award Number">
	    <input name="my_finance_code" type="number" placeholder="MyFinance/Project Code">
	    <input name="department" type="text" placeholder="Department">
	    <input name="supervisor" type="text" placeholder="Supervisor">
	    Award Type: <input class="checkbox-inline" type="radio" name='type' value="1">List here
	    <input name="start_date" type="date" placeholder="Start Date">
	    <input name="end_date" type="date" placeholder="End Date">
		<input id="allocationSubmit" type="submit" value="Search" name="search">
		<input id="allocationAdd" type="submit" value="Add" name="add">
	</form>

	<form id="studentForm" name="studentForm" method="post" enctype="multipart/form-data">
		<h3>Enter one or more fields to search</h3>
	    <input name="first_name" type="text" placeholder="First Name"> 
	    <input name="surname" type="text" placeholder="Surname">
	    <input name="funding_amount" type="number" step="0.01" placeholder="Funding Amount">
	    Jes: 
		<select name="jes" form="studentForm">
		  <option value="0">No</option>
		  <option value="1">Yes</option>
		</select>
		<input name="start_date" type="date" placeholder="Start Date">
	    <input name="end_date" type="date" placeholder="End Date">
	    <input id="studentSubmit" type="submit" value="Submit" name="submit"> <br>
	    <input id="studentAdd" type="submit" value="Add" name="add">
	</form>

	<form id="collaborationForm" name="collaborationForm" method="post" enctype="multipart/form-data">
		<h3>Enter one or more fields to search</h3>
	    <input name="collaborator" type="text" placeholder="Collaborator Name"> 
	    <input name="my_finance_code" type="number" placeholder="MyFinance/Project Code">
	    <input name="award_amount" type="number" step="0.01" placeholder="Award amount">
	    <input name="start_date" type="date" placeholder="Start Date">
	    <input name="end_date" type="date" placeholder="End Date">
		<input id="collaborationSubmit" type="submit" value="Submit" name="submit">
	</form>
</body>

</html>